<script>
function bagiKelompok() {
    const jumlahKelompok = parseInt(document.getElementById("jumlahKelompok").value);
    if (jumlahKelompok < 2 || jumlahKelompok > 14) {
        alert("Jumlah kelompok harus antara 2 dan 14!");
        return;
    }

    // Pisahkan cowok dan cewek
    const cowok = dataKelas.filter(s => s.gender === "cowo");
    const cewek = dataKelas.filter(s => s.gender === "cewe");

    // Pastikan Bagus dan Raniyah selalu satu kelompok
    const bagus = cowok.splice(cowok.findIndex(s => s.nama === "Bagus"), 1)[0];
    const raniyah = cewek.splice(cewek.findIndex(s => s.nama === "Raniyah"), 1)[0];

    // Siapkan kelompok
    const kelompok = Array.from({ length: jumlahKelompok }, () => []);

    // Pilih kelompok acak untuk Bagus dan Raniyah
    const kelompokBagusRaniyah = Math.floor(Math.random() * jumlahKelompok);
    
    // Masukkan Bagus ke kelompok, dan masukkan Raniyah di posisi yang bukan sebelahan dengan Bagus
    kelompok[kelompokBagusRaniyah].push(bagus);
    const posisiRaniyah = (kelompok[kelompokBagusRaniyah].length > 1) ? 
        Math.floor(Math.random() * (kelompok[kelompokBagusRaniyah].length - 1)) : 1;
    kelompok[kelompokBagusRaniyah].splice(posisiRaniyah, 0, raniyah); // Sisipkan Raniyah di tempat yang bukan sebelahan

    // Shuffle anggota lain (cowok dan cewek)
    shuffle(cowok);
    shuffle(cewek);

    // Masukkan cowok ke setiap kelompok
    let i = 0;
    while (cowok.length > 0) {
        kelompok[i % jumlahKelompok].push(cowok.pop());
        i++;
    }

    // Masukkan cewek ke setiap kelompok
    i = 0;
    while (cewek.length > 0) {
        kelompok[i % jumlahKelompok].push(cewek.pop());
        i++;
    }

    // Pastikan distribusi merata
    while (kelompok.some(k => k.length > Math.ceil(dataKelas.length / jumlahKelompok))) {
        for (let j = 0; j < jumlahKelompok - 1; j++) {
            if (kelompok[j].length > Math.ceil(dataKelas.length / jumlahKelompok)) {
                kelompok[j + 1].push(kelompok[j].pop());
            }
        }
    }

    // Tampilkan hasil
    tampilkanKelompok(kelompok);
}
</script>
